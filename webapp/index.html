<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –¢–∞–±–ª–∏—Ü—ñ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      /* –°—Ç–∏–ª—ñ –¥–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –≤–∏–≥–ª—è–¥—É Telegram Mini App */
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        margin: 0;
        padding: 15px;
        background-color: var(--tg-theme-bg-color, #f4f4f5);
        color: var(--tg-theme-text-color, #000000);
        transition: background-color 0.3s, color 0.3s;
      }

      /* –ó–∞–≥–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –ø–æ–ª—ñ–≤ —Ç–∞ —Ñ–æ—Ä–º */
      .form-group {
        margin-bottom: 20px;
        padding: 10px;
        background-color: var(--tg-theme-secondary-bg-color, #ffffff);
        border-radius: 10px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
      }

      input[type="date"],
      select {
        width: 100%;
        padding: 10px;
        box-sizing: border-box;
        border: 1px solid var(--tg-theme-hint-color, #c8c8c8);
        border-radius: 6px;
        background-color: var(--tg-theme-secondary-bg-color, #ffffff);
        color: var(--tg-theme-text-color, #000000);
        appearance: none; /* –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü—ñ—ó –≤–∏–≥–ª—è–¥—É */
        -webkit-appearance: none;
      }

      /* –°—Ç–∏–ª—ñ –¥–ª—è —Ä–∞–¥—ñ–æ-–∫–Ω–æ–ø–æ–∫ (–†–æ–ª—å) */
      .radio-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }
      .radio-group label {
        background-color: var(--tg-theme-button-color, #50a8eb);
        color: var(--tg-theme-button-text-color, #ffffff);
        padding: 8px 12px;
        border-radius: 20px;
        cursor: pointer;
        transition: background-color 0.2s;
        margin-bottom: 0;
        font-weight: normal;
      }
      .radio-group input[type="radio"] {
        display: none;
      }
      .radio-group input[type="radio"]:checked + label {
        background-color: var(
          --tg-theme-text-color,
          #000000
        ); /* –ó–∞—Ç–µ–º–Ω–µ–Ω–Ω—è –¥–ª—è –≤–∏–±—Ä–∞–Ω–æ–≥–æ —Å—Ç–∞–Ω—É */
      }

      /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è/—Å–∫–∞—Å—É–≤–∞–Ω–Ω—è */
      .button-group {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        margin-top: 25px;
      }

      .btn {
        flex-grow: 1;
        padding: 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: opacity 0.2s;
      }

      .btn:active {
        opacity: 0.8;
      }

      .btn-confirm {
        background-color: var(--tg-theme-button-color, #50a8eb);
        color: var(--tg-theme-button-text-color, #ffffff);
      }

      .btn-cancel {
        background-color: var(--tg-theme-hint-color, #d3d3d3);
        color: var(--tg-theme-text-color, #000000);
      }
    </style>
  </head>
  <body>
    <div class="form-container">
    <div class="form-group">
        <label for="title-select">–ù–∞–∑–≤–∞ —Ç–∞–π—Ç–ª—É:</label>
        <select id="title-select" required>
            <option value="" disabled selected>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞–π—Ç–ª—ñ–≤...</option>
        </select>
    </div>

    <div class="form-group">
        <label for="chapter-number-input">–ù–æ–º–µ—Ä —Ä–æ–∑–¥—ñ–ª—É:</label>
        <input type="text" id="chapter-number-input" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 21 –∞–±–æ 21.1" pattern="^[\d]+(\.[\d]+)?$"
            required>
    </div>

      <div class="form-group">
        <label>–†–æ–ª—å:</label>
        <div class="radio-group">
          <div>
            <input
              type="radio"
              id="role-clean"
              name="role"
              value="–ö–ª—ñ–Ω"
              required
            />
            <label for="role-clean">–ö–ª—ñ–Ω</label>
          </div>
          <div>
            <input
              type="radio"
              id="role-translate"
              name="role"
              value="–ü–µ—Ä–µ–∫–ª–∞–¥"
            />
            <label for="role-translate">–ü–µ—Ä–µ–∫–ª–∞–¥</label>
          </div>
          <div>
            <input type="radio" id="role-type" name="role" value="–¢–∞–π–ø" />
            <label for="role-type">–¢–∞–π–ø</label>
          </div>
          <div>
            <input type="radio" id="role-edit" name="role" value="–†–µ–¥–∞–∫—Ç" />
            <label for="role-edit">–†–µ–¥–∞–∫—Ç</label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="date-input">–î–∞—Ç–∞:</label>
        <input type="date" id="date-input" required />
      </div>

      <div class="button-group">
        <button id="cancel-btn" class="btn btn-cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        <button id="confirm-btn" class="btn btn-confirm">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
      </div>
    </div>

<script>
    // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞–π—Ç–ª—ñ–≤ –∑ –±–µ–∫–µ–Ω–¥—É
    async function loadTitles() {
        const titleSelect = document.getElementById('title-select');
        // –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫—Ä–∞–ø–∫—É –∑ –∫–æ–º–æ—é –∑–∞–º—ñ—Å—Ç—å –∫–æ–º–∏
        titleSelect.innerHTML = '<option value="" disabled selected>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞–π—Ç–ª—ñ–≤...</option>';

        // URL –∑–∞–ø–∏—Ç—É (–≤—ñ–¥–Ω–æ—Å–Ω–æ –∫–æ—Ä–µ–Ω–µ–≤–æ–≥–æ —à–ª—è—Ö—É Mini App /miniapp/titles)
        const apiUrl = 'titles';

        try {
            const response = await fetch(apiUrl);
            const data = await response.json();

            if (data.titles && data.titles.length > 0) {
                // –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫—Ä–∞–ø–∫—É –∑ –∫–æ–º–æ—é –∑–∞–º—ñ—Å—Ç—å –∫–æ–º–∏
                titleSelect.innerHTML = '<option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å —Ç–∞–π—Ç–ª;</option>';
                data.titles.forEach(title => {
                    const option = document.createElement('option');
                    // –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫—Ä–∞–ø–∫—É –∑ –∫–æ–º–æ—é –∑–∞–º—ñ—Å—Ç—å –∫–æ–º–∏
                    option.value = title;
                    option.textContent = title;
                    titleSelect.appendChild(option);
                });
            } else {
                // –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫—Ä–∞–ø–∫—É –∑ –∫–æ–º–æ—é –∑–∞–º—ñ—Å—Ç—å –∫–æ–º–∏
                titleSelect.innerHTML = '<option value="" disabled selected>–¢–∞–π—Ç–ª—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ;</option>';
            }
        } catch (error) {
            // –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫—Ä–∞–ø–∫—É –∑ –∫–æ–º–æ—é –∑–∞–º—ñ—Å—Ç—å –∫–æ–º–∏
            console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Ç–∞–π—Ç–ª—ñ–≤;', error);
            // –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫—Ä–∞–ø–∫—É –∑ –∫–æ–º–æ—é –∑–∞–º—ñ—Å—Ç—å –∫–æ–º–∏
            titleSelect.innerHTML = '<option value="" disabled selected>–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è;</option>';
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const confirmBtn = document.getElementById('confirm-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const titleSelect = document.getElementById('title-select');
        const chapterNumberInput = document.getElementById('chapter-number-input');
        const dateInput = document.getElementById('date-input');
        const roleRadios = document.querySelectorAll('input[name="role"]');

        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            loadTitles(); // üî• –í–ò–ö–õ–ò–ö –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –¢–ê–ô–¢–õ–Ü–í üî•
            dateInput.valueAsDate = new Date();

            // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
            confirmBtn.addEventListener('click', () => {
                const selectedTitle = titleSelect.value;
                const selectedChapter = chapterNumberInput.value.trim();
                const selectedDate = dateInput.value;
                let selectedRole = '';

                roleRadios.forEach(radio => {
                    if (radio.checked) {
                        selectedRole = radio.value;
                    }
                });

                // –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫—Ä–∞–ø–∫—É –∑ –∫–æ–º–æ—é –∑–∞–º—ñ—Å—Ç—å –∫–æ–º–∏
                if (!selectedTitle || !selectedRole || !selectedDate || !selectedChapter) {
                    if (Telegram.WebApp.showAlert) {
                        Telegram.WebApp.showAlert('–ë—É–¥—å –ª–∞—Å–∫–∞; –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è;');
                    }
                    return;
                }

                // 1. –§–û–†–ú–£–í–ê–ù–ù–Ø –ö–û–ú–ê–ù–î–ò –ë–û–¢–ê
                // –§–æ—Ä–º–∞—Ç: /updatestatus "–¢–∞–π—Ç–ª" <‚Ññ –†–æ–∑–¥—ñ–ª—É> <–†–æ–ª—å> <–î–∞—Ç–∞ YYYY-MM-DD> <+>
                const botCommand = `/updatestatus "${selectedTitle}" ${selectedChapter} ${selectedRole} ${selectedDate} +`;

                // 2. –í–Ü–î–ü–†–ê–í–ö–ê –î–ê–ù–ò–• –ë–û–¢–£
                Telegram.WebApp.sendData(botCommand);

                // 3. –ó–ê–ö–†–ò–¢–¢–Ø
                Telegram.WebApp.close();
            });

            // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –°–∫–∞—Å—É–≤–∞–Ω–Ω—è
            cancelBtn.addEventListener('click', () => {
                Telegram.WebApp.close();
            });
        } else {
            console.error('Telegram WebApp environment not detected.');
            // –ï–º—É–ª—è—Ü—ñ—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
            confirmBtn.addEventListener('click', () => {
                const title = titleSelect.value || 'TITLE';
                const chapter = chapterNumberInput.value.trim() || '1.0';
                const role = document.querySelector('input[name="role"]:checked')?.value || 'ROLE';
                const date = dateInput.value || 'DATE';
                const botCommand = `/updatestatus "${title}" ${chapter} ${role} ${date} +`;
                alert(`–ï–º—É–ª—è—Ü—ñ—è: –ù–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–∞ ${botCommand}`);
            });
            cancelBtn.addEventListener('click', () => alert('–°–∫–∞—Å–æ–≤–∞–Ω–æ (–ï–º—É–ª—è—Ü—ñ—è)'));
        }
    });
</script>
    </body>
    
    </html>